
# 03. GeliÅŸmiÅŸ Teknikler: Dinamik Payload YÃ¼kleme

## ğŸ“‹ Konu Ã–zeti

**Ä°ki aÅŸamalÄ± silah konsepti**: Ä°lk aÅŸamada temiz gÃ¶rÃ¼nen "stager" yÃ¼klenir, asÄ±l zararlÄ± kod uzaktan gelir. Chrome Web Store taramalarÄ±nÄ± bypass etmenin en etkili yolu.

---

## ğŸ¯ 3.1. Statik vs Dinamik Kod MantÄ±ÄŸÄ±

### Temel Fark

```mermaid
graph LR
    A[Statik Kod] -->|Tespit Edilir| B[âŒ Web Store Reddi]
    C[Dinamik Kod] -->|Temiz GeÃ§er| D[âœ… Store OnayÄ±]
    D -->|Kurulumdan Sonra| E[ğŸ¯ ZararlÄ± Kod Ä°ndirilir]
```

> **Statik**: ZararlÄ± kod eklentiyle birlikte gelir â†’ Tarama sistemleri yakalar  
> **Dinamik**: Eklenti sadece "yÃ¼kleyici", zararlÄ± kod dÄ±ÅŸarÄ±dan gelir â†’ Tespit edilemez

### ğŸ”´ GerÃ§ek DÃ¼nya Ã–rneÄŸi: **The Great Suspender (2021)**

- 2M+ kullanÄ±cÄ±lÄ± Chrome eklentisi
- Ä°lk versiyonlar tamamen temiz
- SatÄ±n alÄ±ndÄ±ktan sonra dinamik kod eklendi
- KullanÄ±cÄ± bilgileri aylarca sÄ±zdÄ±rÄ±ldÄ±
- Google'Ä±n tespit sÃ¼resi: **6 ay**

---

## ğŸ—ï¸ 3.2. Stager Mimarisi

### Ã‡alÄ±ÅŸma MantÄ±ÄŸÄ±

```mermaid
sequenceDiagram
    participant E as Eklenti (Stager)
    participant C as C2 Sunucu
    participant V as Kurban
    
    E->>C: Her 6 saatte: "Yeni emir var mÄ±?"
    C->>E: "Evet, ÅŸu kodu Ã§alÄ±ÅŸtÄ±r"
    E->>E: eval(zararlÄ±_kod)
    E->>V: Keylogger aktif
    V->>E: KullanÄ±cÄ± ÅŸifre yazdÄ±
    E->>C: Åifre gÃ¶nder
```

### ğŸ’¡ Pro Tip: Minimal Ä°zinler

**AkÄ±llÄ± saldÄ±rganlar minimal izinle baÅŸlar:**
- Ä°lk manifest: Sadece `"storage"` ve `"activeTab"`
- ZararlÄ± kod inince dinamik olarak ek izinler ister
- KullanÄ±cÄ± ÅŸÃ¼phelenmez Ã§Ã¼nkÃ¼ eklenti "gÃ¼ncellendi"

---

## ğŸ“¡ 3.3. C2 AltyapÄ±sÄ±

### Legitimate Infrastructure Abuse

```mermaid
graph TD
    A[ZararlÄ± Eklenti] --> B[Pastebin]
    A --> C[GitHub Gist]
    A --> D[Twitter API]
    A --> E[DNS TXT Records]
    
    B -.->|Fallback| F[Yedek C2]
    C -.->|Fallback| F
    D -.->|Fallback| F
    E -.->|Fallback| F
```

### ğŸ”´ GerÃ§ek Ã–rnek: **Raccoon Stealer (2019-2023)**

**KullanÄ±lan C2 yÃ¶ntemleri:**
1. **Telegram Bot API** â†’ Ãœcretsiz, anonim, gÃ¼venilir
2. **Pastebin** â†’ Kolay gÃ¼ncellenebilir
3. **Discord Webhooks** â†’ Rate limit yok
4. **Cloudflare Workers** â†’ HTTPS, legit gÃ¶rÃ¼nÃ¼m

**SonuÃ§**: 50M+ kurban, tespit sÃ¼resi ortalama **180 gÃ¼n**

---

## ğŸ”„ 3.4. Payload Mimarisi

### Ä°ki Tip YaklaÅŸÄ±m

```mermaid
graph LR
    A[Basic Payload] -->|TÃ¼m Kod Bir Seferde| B[HÄ±zlÄ± Kurulum]
    C[ModÃ¼ler Payload] -->|Ä°htiyaca GÃ¶re ModÃ¼l| D[DÃ¼ÅŸÃ¼k Footprint]
    
    B -->|Dezavantaj| E[Kolay Tespit]
    D -->|Avantaj| F[Hedefli SaldÄ±rÄ±]
```

### ğŸ’¡ Pro Tip: ModÃ¼ler YapÄ±

**AkÄ±llÄ± saldÄ±rgan sadece gerekli modÃ¼lleri yÃ¼kler:**
- Banka sitesinde â†’ Keylogger + Form Grabber
- E-ticaret sitesinde â†’ Kredi kartÄ± modÃ¼lÃ¼
- Sosyal medyada â†’ Cookie stealer
- DiÄŸer sitelerde â†’ HiÃ§bir ÅŸey (tespitten kaÃ§Ä±nma)

---

## ğŸª 3.5. Ã‡evresel KoÅŸullu YÃ¼rÃ¼tme

### AkÄ±llÄ± Aktivasyon Stratejileri

```mermaid
flowchart TD
    A[Payload Ä°ndirildi] --> B{Analiz OrtamÄ±?}
    B -->|Evet| C[âŒ HiÃ§bir Åey Yapma]
    B -->|HayÄ±r| D{Hedef Ãœlke?}
    D -->|HayÄ±r| C
    D -->|Evet| E{Ã‡alÄ±ÅŸma Saati?}
    E -->|HayÄ±r| F[â¸ï¸ Bekle]
    E -->|Evet| G{Hedef Site?}
    G -->|HayÄ±r| C
    G -->|Evet| H[ğŸ¯ SaldÄ±rÄ± BaÅŸlat]
```

### ğŸ”´ GerÃ§ek Ã–rnek: **Emotet Banking Trojan**

**Aktivasyon koÅŸullarÄ±:**
1. VM tespit â†’ HiÃ§bir ÅŸey yapma
2. Sandbox tespit â†’ Fake aktivite gÃ¶ster
3. CoÄŸrafya kontrolÃ¼ â†’ Sadece EU bankalarÄ±nda aktif
4. Zaman kontrolÃ¼ â†’ Mesai saatleri (Ã§Ã¼nkÃ¼ bankacÄ±lar o saatte aktif)
5. IP kontrolÃ¼ â†’ Kurumsal IP'lerde daha agresif

**SonuÃ§**: Tespit oranÄ± %3'Ã¼n altÄ±nda kaldÄ±

---

## ğŸ›¡ï¸ 3.6. Anti-Analysis Teknikleri

### VM/Sandbox Tespit MantÄ±ÄŸÄ±

```mermaid
graph TD
    A[Eklenti BaÅŸlatÄ±ldÄ±] --> B{Headless Browser?}
    B -->|Evet| C[ğŸ­ Masum Davran]
    B -->|HayÄ±r| D{DevTools AÃ§Ä±k?}
    D -->|Evet| C
    D -->|HayÄ±r| E{navigator.webdriver?}
    E -->|Evet| C
    E -->|HayÄ±r| F{Timing Anormal?}
    F -->|Evet| C
    F -->|HayÄ±r| G[âœ… GerÃ§ek Kurban]
    G --> H[ğŸ¯ Payload Aktif]
```

### ğŸ’¡ Pro Tip: Sleep Before Execute

**GeliÅŸmiÅŸ sandboxlar 5 dakika beklemez:**
```
Ä°lk kurulum â†’ 2-3 gÃ¼n bekle
Ä°lk payload â†’ 30 dakika sonra
ZararlÄ± aktivite â†’ Sadece aktif kullanÄ±m anÄ±nda
```

**Ã–rnek**: Dridex malware 7 gÃ¼n bekliyor, Ã§Ã¼nkÃ¼ analiz sistemleri max 48 saat test ediyor.

---

## ğŸ”§ 3.7. Payload YÃ¶netimi

### Version Control + Kill Switch

```mermaid
sequenceDiagram
    participant M as Malware
    participant C as C2
    participant A as Analyst
    
    loop Her Saat
        M->>C: Version check (v1.2)
        C->>M: GÃ¼ncelsin, devam
    end
    
    A->>C: Tespit edildi!
    
    Note over C: Kill switch aktif
    
    M->>C: Version check
    C->>M: KILL_SIGNAL
    M->>M: Self-destruct
    M->>M: Clear all traces
```

### ğŸ”´ GerÃ§ek Ã–rnek: **NetWire RAT**

**Kill switch stratejisi:**
1. Botnet bÃ¼yÃ¼dÃ¼kÃ§e tespit riski artar
2. Analiz baÅŸladÄ±ÄŸÄ±nda â†’ TÃ¼m payload'lar temizlenir
3. Sadece stager kalÄ±r (zararsÄ±z gÃ¶rÃ¼nÃ¼r)
4. 2-3 hafta sonra yeni payload ile devam

**SonuÃ§**: AynÄ± kampanya 5 yÄ±l boyunca farklÄ± payload'larla devam etti

---

## ğŸ“Š BÃ¼yÃ¼k SaldÄ±rÄ± Ã–rnekleri

### ğŸ”´ SolarWinds Supply Chain (2020)

**Dinamik payload kullanÄ±mÄ±:**
```mermaid
graph LR
    A[Temiz GÃ¼ncellemeler] -->|9 Ay| B[GÃ¼ven OluÅŸtur]
    B -->|Tek GÃ¼ncelleme| C[Backdoor Stager]
    C -->|14 GÃ¼n Sonra| D[C2'den Payload]
    D -->|Hedefli| E[Sadece Kritik Åirketler]
```

- 18,000 kurulum â†’ Sadece 100'Ã¼ hedeflendi
- Tespit sÃ¼resi: **8-9 ay**
- Zarar: $100M+

### ğŸ”´ CCleaner Hijack (2017)

**Ä°ki aÅŸamalÄ± saldÄ±rÄ±:**
1. AylÄ±k 2M indirme, 1 ay temiz versiyonlar
2. Tek gÃ¼ncelleme ile stager eklendi
3. C2'den hedefli payload (sadece tech firmalarÄ±)
4. 40+ bÃ¼yÃ¼k ÅŸirket etkilendi

**Kritik nokta**: Statik olsaydÄ± ilk taramada yakalanÄ±rdÄ±

---

## ğŸ’¡ Savunma Ä°Ã§in Pro Tipler

```mermaid
graph TD
    A[Savunma KatmanlarÄ±] --> B[Network Monitoring]
    A --> C[Behavior Analysis]
    A --> D[Runtime Detection]
    
    B --> E[C2 trafiÄŸini yakala]
    C --> F[eval Ã§aÄŸrÄ±larÄ±nÄ± tespit et]
    D --> G[Dinamik kod yÃ¼klemesini engelle]
```

**En etkili savunma:**
1. **CSP (Content Security Policy)** â†’ eval() kullanÄ±mÄ±nÄ± engelle
2. **Network traffic analysis** â†’ Pastebin/Gist isteklerini flagle
3. **Behavioral heuristics** â†’ YÃ¼kleme sonrasÄ± davranÄ±ÅŸ deÄŸiÅŸikliÄŸi
4. **Manifest V3 zorlamasÄ±** â†’ Dinamik kod Ã§alÄ±ÅŸtÄ±rmayÄ± kÄ±sÄ±tla

---

## ğŸ¯ Kritik Ã‡Ä±karÄ±mlar

| Statik YaklaÅŸÄ±m | Dinamik YaklaÅŸÄ±m |
|----------------|------------------|
| âŒ AnÄ±nda tespit | âœ… Ä°lk tarama bypass |
| âŒ GÃ¼ncellenemez | âœ… Uzaktan yÃ¶netilebilir |
| âŒ Tek amaÃ§ | âœ… Hedef bazlÄ± modÃ¼ler |
| âŒ IOC'lar sabit | âœ… Ä°mzasÄ±z saldÄ±rÄ± |

**GerÃ§ek**: Modern APT gruplarÄ±nÄ±n %90'Ä± dinamik payload kullanÄ±yor.

---

**Ã–nceki Konu:** [02. Veri SÄ±zdÄ±rma](02.veri-sizdirma.md) | **Sonraki Konu:** [04. Linux KalÄ±cÄ±lÄ±k](04.linux-kalicilik.md)
